#!/usr/bin/env ruby

require 'docme'
require 'docme/utils'
require 'fileutils'

files = Array.new
path = ARGV[0]


puts "\n  ***Begining docme magix***"

#create the directory where the site will be stored
if !File::directory?("docme_site")
    puts "+Setting up docme's living arrangements."
    Dir.mkdir("docme_site")
    puts "Woohoo! docme has a home!"
end

#if a directory was provided
if File.directory?(path)
    #foreach file in the path specified
    Dir.foreach(path) do |file|
        next if file == '.' || file == '..'

        next if file.rindex('.', 0)

        #if there is a sub directory
        if File.directory?(path+"/"+file)
            #for each file in the sub directory
            Dir.foreach(path + "/"+ file) do |f|
                next if f == '.' || f == '..'

                next if f.rindex('.', 0)

                next if File.directory?(path+"/"+file+"/"+f)

                page = Docme.jsParse(path+"/"+file+"/"+f)

                #add page to docme dir
                if page != nil
                    FileUtils.mv(page, "docme_site/"+page)
                    files.push(page)
                end

            end
        else
            page = Docme.jsParse(path+"/"+file)

            if page != nil
                    FileUtils.mv(page, "docme_site/"+page)
                    files.push(page)
            end
        end

    end
else #if a single file was provided
    page = Docme.jsParse(path)
    FileUtils.mv(page, "docme_site/"+page)
    files.push(page)
end

renderIndex(files)

#add page to docme dir
FileUtils.mv("index.html", "docme_site/index.html")

puts "\nFiles generated by docme:"
puts files
puts "\n  ***Finished docme magic!***"
puts "\n  You can find your docs inside the `docme_site` folder. \n   Hint: look for index.html\n\n"
