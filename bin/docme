#!/usr/bin/env ruby

require 'docme'
require 'docme/utils'
require 'fileutils'

files = []
path = ARGV[0]

if ARGV[0] == nil
    path = './'
else
    path = ARGV[0]
end

puts "\n  ***Begining docme magix***"

# create the directory where the site will be stored
unless File.directory?('docme_site')
    puts "+Setting up docme's living arrangements."
    Dir.mkdir('docme_site')
    puts 'Woohoo! docme has a home!'
end

# if a directory was provided
if File.directory?(path)

    files.concat parse_directory(path)

else # if a single file was provided

    # raise exception if no file provided, file does not exsist, the file is not readable, or the file has no content
    if !File.file?(path) || !File.exist?(path)
        fail 'Please provide a path to the file you wish to docme.'
    end

    files.push(parse_file(path))

end

render_index(files)

# add page to docme dir
FileUtils.mv('index.html', 'docme_site/index.html')

puts "\nFiles generated by docme:"
puts files
puts "\n  ***Finished docme magic!***"
puts "\n  You can find your docs inside the `docme_site` folder. \n   Hint: look for index.html\n\n"
